language: java
jdk:
- oraclejdk8
services:
- docker
before_script:
- npm install -g bower
cache:
  directories:
  - $HOME/.m2
sudo: false
install: true
script: mvn install -Ppackage
env:
  global:
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - secure: JWPphpSGIiCtpUqHNc1OV6mnYsoIKFlCtrJHcxF3KH/5YyJVk0nCb/nuvxKFjI609wZ4cHIed/ex7XUTcm929dVpKvHO8OcIlNIhdUQfaBMod3CaDaUXl0nYgL0cHeUbKYAhkHULKsZ/PtsDwqNBrdbgMioKFe/69xzC5+5Wos6Vz3jehRVqPTEntgwweTU9gq4DOcXOZJaGAIU6yzrawvaBvxOylubsVQ/j6d4hT6AzpRW46MX9+a1ZSFcTHS+mNiQAUy+f9sjCwZ9FFnabd6U4eGCAXcEqQsqL7PBXnX8D9lWDHp2tN84xdX6OsiQFkJ7m8VwfXq4I+qu8P/2GgWySaRN2RjLGyaoUDNMDRG3sjJEvaneDWjPJOq/VbEKNIXAasgALKdtNPqmvIu7dXAVP6vw2FSAgCJ0DQfQW0ROPvNlBDnpOo7kiBMy4W4BA7gw5ulgy/JHUKEVHgKwuKAfuHtETVJOQ9ZmoEc0G4npIobrNljD+CcoD8g/KAxzAAvmC6z8Nof3akqaAC+dggVrZwMsTaReQuzci6IdSHXUiCZNQJUHd4flWmTYbyK1PQv5IlkYpmrmxxM9rZPze/InYoGAM/FY4kQTSEG2P8l+l51cV+6NuQCktia3DNZRZV1jukQCnmUv9HLKaXdjlQ7Vqt8AFhiaijnJvFF15PgY=
  - secure: ZzgBE9gAXtHxDaoIWmwPBTj2kSDAiyD6D/FQHfG2mpHTp7opDEZXFS0/WIS0yYWdBhUZUju1QDrGLTntFkC2S3eYO4bXcGffmncD6raRLiU7BThPHltenJ0OdBJyhaqoiv1OJlYf55Thrk5tr7SRukwF9vyHH3coXl0sSCDEVScrKLcuavpgm3y/7MkIv2u1ICFK7qQl2qNvxdOK8fcjm5gLCKMwlYSChDeeageEfRC9MSodTBSM3nVenCTLXuVM/EiCx9IJxbmcUFLutG825Dp3hCJx7g+6YablaqVE4zyUamCigH2Bypnh3vPyJRbo5dcgvxmSiYgEuaSSXPxdNzzGhSOl++i3s6q+L5/yOruVCmhnZBjQ2fd1hpaQXsH2xKrGhHtMoals0JX0K0gHG+LWUS6d8nsZxscNjg2lUymmmUcaYUE7ChFkzZEIRxagXslkrE888BUWuEjtz/yjIsxnLOrNVuA6KZduPBVvVadGkUPTAhfsq/ntBsGqFG939FVfINwfxT8UkHuMdFZtC/eVz3mqt9ztrLSCRH0Bxr3BwMVIuOvygjv1qJayRw3tNFKmihe+GgpT00aytRDSZ+n/J9AlsQlsHre83mYDB8x980Ya5sp323LlND+IUqS99c4jktqp1KqwMxN0F9EU7kHPVlJ5xbRX8NAtGs3MdSk=
  - secure: PbivcN+8exzwipvPaAarg9e6GK3OlBx9LLHGu44aoxp3muWQJHtT3nZ3oWSEt7uFCBJMUvDmwjZRP+HwGE+b8TFJa7GeExdo1DXtzIiMYU5G1ISvbd1fdvdO7Xps9Nxm7gep3UeEtXpUPiq05rkaPgwSXX10z2+yXId89/rnl0CEwyP1V5zYgmaunMcJagmfTPd2W7Ru+TyyhEFD4oxcEGrcprC9AsXBWXdTKdteUaSmfhzIlNMym9ZWkUHWjdK/xj9b7gVTpS+MLxc6BTOedTK9HXSF1+Ti1Yhy8Ywh+27R1ee7H9ANEM2OrmJd9oWxmiXmt210TxU1ovS1Er1hCWovNyzCYDsvQaNst5hhoD6E9xkRyLxy1hOFMEr9IfUdGUwrduJdKYxKERQAHV/dHR74vOEKyWIiE/V2onRTXYRl8gwPRAfJbfwjAbW9Dvqnbs45kKWM0Lc5BJdRa5hIo98VG5C4j+PyWFKi6pTB4MINMh6F1nd1mSbJPiQ8knBnM9t9bTxskG1xKrXZLdcDcb8H272zBuKid7oHfRu3xcRtwsg8E76BFPJrBphUE9+sFgql7/3R1JRUwG9uFJYMiMSf7nRF4+V4yje0BlkC5qlCpdotGIPfCoL1tWShtnm2MYf3X0im/gAQVnHVP3Mf1Gy1Vb5eJC4PNnJS5G/AlcE=
  - secure: bSTCzkPGSmFka9ZcQS8E1pqXhfrfSbtdmJay2/GmGEwQgIQngVlmXxO97Rq+9mkFhLpkkMVNJJbmSewFrdkPh5JopQV+sDYzEDM+B8NWKnDOdAbJrNq1HcScK0QwM1n69BFLBT0CtlwT5/U8x/50TxhzLOHO1YyiPBiY7BywjBk07fhDqr01M6QTUF6H0XpHV2CPEfp6eePV2YEOaorLifWpzL3FSF+gnXVxGDOws3rY2yWKrywIAoiDznii+Rk1DnwL8ESUNLLkFFaWh24g8jkakbPUeW7jqLynjJUVYCvqM5CW/5WLMEkutgrhbUGBvkgDKPcMo1HkaifAAaXt0yuuHSr5J0/DF85prNwT0lk/JH+OqiYT1JkhI8fV8jw26pLa6hzo80eL1+6hv1+d4eA2PXqsGCGLyDxPyVLH1JGcOTIys14jPLJtMSXyHX9vCTunJB3vfpFuJ6g+nRNnS+Zzm6CqKVbWicajrFFov/BVx5giscfSDFN1kdIqf5qF3cQUSUJ1FohEzl79mp3uvBl4yQePN7XiR92sPzDw+7SKdEa+MT188ITbx2u38WUTbq0VNmE+ZfZ4rheeO1BcUIwGiDgDEcpa40bM+/A4S8Ekqju6t4AziFMcQbfq/VEGpKfaFj2e3t3U5m3WBk06sjhzuX1KE31obvGx8h9aIF0=
  - secure: Kdl2opXTtJQhQCxoaZfDW+EQVkVxRi3Z7aMSn53E8E+KZhawdddZutoG93xFO02JQ9KtNTn7rbtb9VPb3GnRYAhdhD1GO/XCcdx78C/J/n4LK+LHEtgb4+8Qk6p1rb4WASTTwsy0XdpJIShdvvg2uJl8EpfUYNWcAgjtSzgIwqMg6a1GS/Utxz1yR+l862WCeH48UP7ie2mbTW5Bk45ZGULmVYX2bshLu6hfY3u35P2xjuZSDlaPQhWzK3txG4RxaWqSEMIhUPwQEG+9SA22Gj1eOZ2pZQeZCUsUlcGN/9k5xs5ig8l0pVc/jSziwFuKjcl6xSSo16hI96L3DeQRydgus5QjXFkaC2YSxnKEtMLWrF6+EMvbdFsG7O0hb2cZykzc8DMlN5TM5PsI+C8s4sqjHS5axKzfswDmTE09x74zia1XWrFcoMQ/hMz4Bc0A5fxD358aERxFixhdosPVmmtdpOzOqe1ap7RbYuL9mBj+OwRsgSsV85R/TlazbNtUeghQ2QknZkQzqAGNyNup+Guyf4V4k51Im8q0m1N5ODdrTGpsF6/VV7w1fw3wScDCbS4h9iZ0uuk+4PsZgHInf/3hXs/V5ayurE6144Y2EMM0RuuCkcJKtP1VfpmWuCmG2zov0l1qfkDZtan3pTr+F+wcx+j3qGqDHneOeEVaYkw=
  - secure: PCY+AvYXHlNMNhwy08sYSnE+pNGZhsqJLaclnd/UAq+Ud5XJaqQUBObaqFotDXVfCFkhlPXov9Biczgoikucuj1i93ov+5mi1ooVJgcBUx6cukig38BjVi4VDobhJzln+oL3xm9OjjSNzhqRmrY08aMNwzqp1Ey1KC99+ayhAU3haOYuoXOuSOu3hDpLncgCDYEYiWUc+fMR+P9S8Uuuy3ZnwQ/73SYeIikmF1I5Xy5BrG2K/E3lzeFAe5Q1ggki75AZAhVtcHoV4Z9BTDWkMS6YK43Z1o+ZuZ63jqW0Mm7uPD7feAH3neYesz4epL0ecsT8D4MOg8aT6qsJdl0j2OiGQxHV4NmpYq/YIK9310zTgM2HyOv6nyrcASbMcGmukY2T2zh6lHs9De/h61Zfecp8ZQfD8F4nv8NgoltSzGDAGmNG91PTL286VsZQjofS/4zub9/9nMi7zPYgFaxd3XgeE3FVE0wKdtpasXOmdTe/fBFutNRed+PG0OMQjysRw0inFP9nYcfKNAAKjSN0qdZQgO1qAQgfN9H0M5iVwdCv1ZoDCcWDA2FZbLJsu9Dq1bfMvsj6o1ulBHiOm39q5NowE1ya01QtkxSFt8S5bfuMWfY3wf9MztozZODetwhO9V82XJnBLT0ge6nAvXmZbMYdk0ewPS3Oq3jCfR7QrbE=
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
- export REPO=portlandwebworks/chhs-frontend
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
- mvn docker:build
- docker tag $REPO $REPO:$TAG
- docker tag $REPO $REPO:travis-$TRAVIS_BUILD_NUMBER
- docker push $REPO
- curl https://sdk.cloud.google.com | bash
- source /home/travis/.bashrc
- gcloud components update kubectl
- kubectl config set-credentials default --username=${GKE_USERNAME} --password=${GKE_PASSWORD}
- kubectl config set-cluster default --server=${GKE_SERVER} --insecure-skip-tls-verify=true
- kubectl config set-context default --cluster=default --user=default
- kubectl config use-context default
- kubectl rolling-update frontend-controller --image=portlandwebworks/travis-$TRAVIS_BUILD_NUMBER
